# –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ üëã
–ü—Ä–∏–≤–µ—Å—Ç–≤—É—é. –∑–¥–µ—Å—å —Å–æ–±—Ä–∞–Ω–æ —Ä–µ—à–µ–Ω–∏—è —Ç–µ—Å—Ç–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ "–î–æ—Å—Ç–∞–µ–≤—Å–∫–∏–π". 
# –¶–µ–ª—å
–ó–∞–ø—Ä–∞—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–µ —Å —Å–∞–π—Ç–∞ –¶–µ–Ω—Ç—Ä–∞ –ë–∞–Ω–∫–∞. –ò –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂ –æ—Ç –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏
# üìÉ –ê–ª–≥–æ—Ä–∏—Ç–º
  - –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ –≤ –∑–∞–¥–∞—á–µ
  - –ü–∞—Ä—Å–∏–Ω–≥ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏ —Å —Å–∞–π—Ç–∞ –¶–ë
  - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º–æ–π –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–µ –Ω–∞ –º–µ—Å—è—Ü
  - –°–ª–∏–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞–≤–æ–∫ –∏ –ø—Ä–æ–¥–∞–∂
  - –§–æ—Ä–º–∏—Ä—É–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

# –ò–Ω—É—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
# üßë‚Äçüíª–†–µ—à–µ–Ω–∏–µ 

### –ü–∞—Ä—Å–∏–Ω–≥ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏
----

```
def parse_date(date):
  date = date.split('-')[::-1]
  return '.'.join(date)

date_end = (pd.to_datetime(dates[-1]) + pd.DateOffset(months=1)).strftime('%d.%m.%Y')

date_start = parse_date(dates[0])

url = f'https://www.cbr.ru/hd_base/keyrate/?UniDbQuery.Posted=True&UniDbQuery.From={date_start}&UniDbQuery.To={date_end}'

response = requests.get(url)

soup = BeautifulSoup(response.text, 'html.parser')
dates_table = soup.find('table', class_='data')

data_rates = {}

rates_date = dates_table.find_all('tr')
for index, rate_date in enumerate(rates_date):
  if index == 0:
    continue
  _, date, rate, _ = rate_date.text.split('\n')
  rate = float(rate.replace(',', '.'))
  date = date.split('.')
  if 'Day' not in data_rates:
    data_rates['Day'], data_rates['Month'], data_rates['Year'], data_rates['Rate'] = [date[0]], [date[1]], [date[2]], [rate]
  else:
    data_rates['Day'].append(date[0])
    data_rates['Month'].append(date[1])
    data_rates['Year'].append(date[2])
    data_rates['Rate'].append(rate)
df_rates = pd.DataFrame(data_rates)
```
–§—É–Ω–∫—Ü–∏—è `parse_date` —Å–ª—É–∂–∏—Ç –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –¥–∞—Ç—ã –∫ —Ñ–æ—Ä–º–∞—Ç—É –≤ —Å—Å—ã–ª–∫–µ —Å–∞–π—Ç–∞ –¶–ë. –¢–æ –µ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç `–î–î.–ú–ú.–ì–ì–ì–ì`.
`data_start` ‚Äî –Ω–∞—á–∞–ª–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç.

`data_end` ‚Äî –∫–æ–Ω–µ—Ü –¥–∏–∞–ø–∞–∑–æ–Ω–∞.

`url` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç –¶–ë —Å –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–æ–π —Å –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –¥–∞—Ç –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ.

`data_rates` ‚Äî —Ö—ç—à-—Ç–∞–±–ª–∏—Ü–∞, –∞ –ø–æ—Ç–æ–º –∏ DataFrame —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ `Day` (–¥–µ–Ω—å), `Month` (–º–µ—Å—è—Ü), `Year` (–≥–æ–¥) –∏ `Rate` (–∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–æ–π). –ò—Ö –º—ã –ø–æ–ª—É—á–∞–µ–º —Å –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü.

–ò—Å—Å–ª–µ–¥–æ–≤–∞–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—É, –±—ã–ª–æ –≤—ã—è—Å–Ω–µ–Ω–æ, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–µ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –¥–∞—Ç—É —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ —Ç–µ–≥–µ `tr`, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–º –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞ `table` –∫–ª–∞—Å—Å–∞ `data`: `<table class="data">`. –û–¥–Ω–∞–∫–æ —Å—Ç–∞–≤–∫–∞ —Ç–∞–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–∏–ø–µ `float`, –Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–µ —Ç–æ—á–∫–æ–π —Å –∑–∞–ø—è—Ç–æ–π. –ü–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∑–∞–º–µ–Ω–∏—Ç—å —Ç–æ—á–∫—É –Ω–∞ –∑–∞–ø—è—Ç—É—é –∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç–∏–ø—É `float`, —Ç–∞–∫ –∫–∞–∫ –ø–∞—Ä—Å–∏—Ç—Å—è –≤—Å—ë –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤ —Ç–∏–ø–µ `str`.

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–µ –∑–∞ –º–µ—Å—è—Ü
---

–î–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –¥–æ —Å–∏—Ö –ø–æ—Ä –¥–ª—è –º–µ–Ω—è —Ç–æ—á–Ω–æ –Ω–µ –ø–æ–Ω—è—Ç–Ω–∞. –õ–∏—á–Ω–æ —è –µ–µ –ø–æ–Ω—è–ª —Ç–∞–∫: —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –º–µ—Å—è—Ü—É –∏ –Ω–∞–π—Ç–∏ –≤ –∫–∞–∂–¥–æ–º –º–µ—Å—è—Ü–µ –Ω–∞–∏–±–æ–ª—å—à—É—é —Å—Ç–∞–≤–∫—É. –í –º–æ—ë–º —Å–æ–ª—É—á–∞–µ –¥–µ–Ω—å, –º–µ—Å—è—Ü –∏ –≥–æ–¥ —Ä–∞–∑–¥–ª–µ–Ω—ã –Ω–∞ –∫–æ–ª–æ–Ω–∫–∏, –ø–æ—ç—Ç–æ–º—É –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –¥–µ–ª–∞–µ–º –ø–æ –¥–≤—É–º –∫–æ–ª–æ–Ω–∫–∞–º - –ø–æ –º–µ—Å—è—Ü—É –∏ –≥–æ–¥—É –∏ –Ω–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ —Å –∫–ª—é—á–µ–≤–æ–π –¥–∞—Ç–æ–π. –í–æ—Ç –∫–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–µ—Ç:
```
df_rates = df_rates.groupby(['Month', 'Year'])['Rate'].max().reset_index()
```
### –°–ª–∏—è–µ–Ω–∏–µ –¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü
---
–¢–µ–ø–µ—Ä—å —Å–æ–ª—å–µ–º –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –æ–¥–Ω—É. –î–ª—è —ç—Ç–æ–≥–æ —Å–¥–µ–ª–∞–º –≤ —Ç–∞–±–ª–∏—Ü–µ `df_rates` –∫–æ–ª–æ–Ω–∫—É `date` –∏ –∑–∞–ø–∏—à–µ–º —Ç—É–¥–∞ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –≤ —Ç–∞–±–ª–∏—Ü–µ `df_sales`. –ù–∞–ª–∏—á–∏–µ –æ–±—â–µ–π –∫–æ–ª–æ–Ω–∫–∏ –∂–ª–µ–∞—Ç–µ–ª—å–Ω–æ!
```
df_rates['date'] = pd.to_datetime(df_rates['Year'].astype(str) + '-' + df_rates['Month'] + '-01')
```
–ï—Å–ª–∏ —á—Ç–æ, –≤ —Ç–∞–±–ª–∏—Ü–µ `df_sales` –≤ –∫–æ–ª–æ–Ω–∫–µ `date` —É–∫–∞–∑–∞–Ω–æ –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤–æ–π —á–∏—Å–ª–æ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ –≤ —É–∫–∞–∑–∞–Ω–æ–º –ø–µ—Ä–∏–æ–¥–µ –¥–∞—Ç, –Ω–æ –æ–Ω–∏ –≤ –æ–±—ã—á–Ω–æ–º —Å—Ç—Ä–æ—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –ø—Ä–∏–≤–µ–¥–º –∏—Ö –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É —Å –ø–æ–º–æ—â—å—é `to_datetime`.

```
df_sales['date'] = pd.to_datetime(df_sales['date'])
```

–¢–µ–ø–µ—Ä—å —Å–æ–µ–¥–µ–Ω–∏–º —Ç–∞–±–ª–∏—Ü—ã. –¢–∏–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è - `left`. –õ–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ - `df_sales`, –∞ –ø—Ä–∞–≤–∞ - `df_rates`. –î–∞–Ω–Ω—ã–π —Ç–∏–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω—Å–µ–Ω—ã –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ª–æ–Ω–∏–∫ –∏–∑ –ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã, –∏ —á–∞—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø—Ä–∞–≤–æ–π, –≥–¥–µ —Å–æ–≤–ø–∞–ª–∏ –∏–Ω–¥–µ–∫—Å—ã. –í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å–≤–∏—è —Å–æ–≤–ø–∞–¥–∞—é—â–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –±—É–¥–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `NaN`. –ò–∑ –ø–∞—Ä–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –Ω–∞–º –Ω—É–∂–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `date`, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∞ —è–≤–ª—è–µ—Ç—Å—è –æ–±—â–µ–π –¥–ª—è –¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü –∏ –ø–æ –Ω–µ–π –±—É–¥–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –∏ –∫–æ–ª–æ–Ω–∫–∞ `Rate` -  –∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞.

```
table_result = pd.merge(
    df_sales,
    df_rates[['date', 'Rate']],
    on='date',
    how='left'
)
```

–ù—É –∏ –ø—Ä–∏–≤–µ–¥–º –¥–∞—Ç—ã –≤ –∏—Ç–æ–≥–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ –∫ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É: 
```
table_result['date'] = table_result['date'].dt.strftime('%Y-%m-%d')
```

–°–æ—Ö—Ä–∞–Ω–∏–º —Ç–∞–±–ª–∏—Ü—É –≤ —Ñ–∞–π–ª `–¢–∞–±–ª–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫ –∏ –ø—Ä–æ–¥–∞–∂.xlsx`:
```
table_result.to_excel('–¢–∞–±–ª–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫ –∏ –ø—Ä–æ–¥–∞–∂.xlsx', index=False)
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
---

